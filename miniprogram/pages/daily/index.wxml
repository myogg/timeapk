<view class="page">
  <view class="card">
    <view style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30rpx;">
      <view style="font-size: 36rpx; font-weight: bold; color: #333;">å·¥ä½œè®°å½•</view>
      <view style="font-size: 28rpx; color: #666;">{{currentDate}}</view>
    </view>

    <view wx:if="{{workItems.length > 0}}" style="margin-bottom: 30rpx;">
      <view style="display: flex; justify-content: space-between; align-items: center; background: #f5f5f5; padding: 20rpx; border-radius: 15rpx; margin-bottom: 20rpx;">
        <text style="color: #666;">å…± {{workItems.length}} ç§å·¥ä»¶</text>
        <text style="color: #666;">æ€»è®¡ {{totalQuantity}} ä»¶</text>
        <text style="color: #666;">é¢„è®¡ {{totalHours}} å°æ—¶</text>
      </view>

      <view wx:for="{{workItems}}" wx:key="id" style="background: #f9f9f9; border-radius: 15rpx; padding: 20rpx; margin-bottom: 20rpx;">
        <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10rpx;">
          <view style="font-size: 32rpx; font-weight: bold; color: #333;">{{item.name}}</view>
          <view style="display: flex; gap: 10rpx;">
            <button size="mini" type="primary" bindtap="onEditItem" data-item="{{item}}">ç¼–è¾‘</button>
            <button size="mini" type="warn" bindtap="onRemoveItem" data-id="{{item.id}}">åˆ é™¤</button>
          </view>
        </view>
        <view style="color: #666; font-size: 28rpx;">
          <text wx:if="{{item.isHourlyBased}}">
            å·¥æ—¶: {{(item.timePerUnit / 60).toFixed(2)}} å°æ—¶
          </text>
          <text wx:else>
            æ•°é‡: {{item.quantity}} ä»¶ Ã— {{item.timePerUnit}} åˆ†é’Ÿ = {{item.totalTime}} åˆ†é’Ÿ
          </text>
        </view>
      </view>
    </view>

    <button class="btn-primary" bindtap="onAddItem" style="margin-bottom: 20rpx;">
      <text style="margin-right: 10rpx;">â•</text>
      æ·»åŠ å·¥ä»¶
    </button>

    <button wx:if="{{workItems.length > 0}}" class="btn-secondary" bindtap="onSaveRecord">
      <text style="margin-right: 10rpx;">ğŸ’¾</text>
      ä¿å­˜è®°å½•
    </button>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘å·¥ä»¶å¼¹çª— -->
  <view wx:if="{{showForm}}" class="modal-mask">
    <view class="modal-content">
      <view style="font-size: 36rpx; font-weight: bold; color: #333; margin-bottom: 30rpx; text-align: center;">
        {{editingItem ? 'ç¼–è¾‘å·¥ä»¶' : 'æ·»åŠ å·¥ä»¶'}}
      </view>

      <view style="margin-bottom: 20rpx;">
        <view style="font-size: 28rpx; color: #666; margin-bottom: 10rpx;">å·¥ä»¶åç§°</view>
        <input 
          type="text" 
          placeholder="è¯·è¾“å…¥å·¥ä»¶åç§°" 
          value="{{formData.name}}"
          bindinput="onFormInput" 
          data-field="name"
          style="width: 100%; padding: 20rpx; border: 1px solid #ddd; border-radius: 10rpx; font-size: 28rpx;"
        />
      </view>

      <view style="margin-bottom: 20rpx;">
        <label style="display: flex; align-items: center;">
          <switch 
            checked="{{formData.isHourlyBased}}" 
            bindchange="onSwitchChange"
            color="#3B82F6"
          />
          <text style="margin-left: 10rpx; font-size: 28rpx; color: #666;">æŒ‰å°æ—¶è®¡ç®—çš„é…ä»¶ï¼ˆå•ä»¶ï¼‰</text>
        </label>
      </view>

      <view style="display: flex; gap: 20rpx; margin-bottom: 20rpx;">
        <view style="flex: 1;">
          <view style="font-size: 28rpx; color: #666; margin-bottom: 10rpx;">æ•°é‡</view>
          <input 
            type="number" 
            placeholder="æ•°é‡" 
            value="{{formData.quantity}}"
            bindinput="onFormInput" 
            data-field="quantity"
            disabled="{{formData.isHourlyBased}}"
            style="width: 100%; padding: 20rpx; border: 1px solid #ddd; border-radius: 10rpx; font-size: 28rpx; {{formData.isHourlyBased ? 'background: #f5f5f5;' : ''}}"
          />
        </view>

        <view style="flex: 1;">
          <view style="font-size: 28rpx; color: #666; margin-bottom: 10rpx;">
            {{formData.isHourlyBased ? 'å·¥æ—¶(å°æ—¶)' : 'å•ä»¶å·¥æ—¶(åˆ†é’Ÿ)'}}
          </view>
          <input 
            type="number" 
            placeholder="{{formData.isHourlyBased ? 'å°æ—¶' : 'åˆ†é’Ÿ'}}"
            value="{{formData.timePerUnit}}"
            bindinput="onFormInput" 
            data-field="timePerUnit"
            style="width: 100%; padding: 20rpx; border: 1px solid #ddd; border-radius: 10rpx; font-size: 28rpx;"
          />
        </view>
      </view>

      <view style="display: flex; gap: 20rpx;">
        <button class="btn-primary" style="flex: 1;" bindtap="onSubmitForm">
          <text>{{editingItem ? 'æ›´æ–°' : 'ç¡®è®¤'}}</text>
        </button>
        <button class="btn-secondary" style="flex: 1; background: #999;" bindtap="onCancelForm">
          <text>å–æ¶ˆ</text>
        </button>
      </view>
    </view>
  </view>
</view>
